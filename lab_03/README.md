# Лабораторная работа #3

## Условие задачи

Разреженная (содержащая много нулей) матрица хранится в форме 3-х объектов: 

- вектор A содержит значения ненулевых элементов;
- вектор JA содержит номера столбцов для элементов вектора A;
- связный список IA, в элементе Nk которого находится номер компонент
в A и JA, с которых начинается описание строки Nk матрицы A.

1. Смоделировать операцию умножения вектора-строки и матрицы, хранящихся в этой форме, с получением результата в той же форме.
2. Произвести операцию умножения, применяя стандартный алгоритм работы с матрицами.
3. Сравнить время выполнения операций и объем памяти при использовании этих 2-х алгоритмов при различном проценте заполнения матриц.

## Описание ТЗ

Разработать программу умножения разреженных матрицы и вектора. Предусмотреть возможность ввода данных, как с клавиатуры, так и использования заранее подготовленных данных. Матрицы хранятся и выводятся в форме трех объектов. Для небольших матриц дополнительно вывести матрицу в виде матрицы. Сравнить эффективность (по памяти и по времени выполнения) стандартных алгоритмов обработки матриц с алгоритмами обработки разреженных матриц при различной степени разреженности матриц и различной размерности матриц.

### Исходные данные

Матрица считывается со стандартного потока ввода или генерируется с указанными размерами.

### Результаты

Результаты выводятся на экран: матрица и ветор в обычном виде (до 10 элементов); результат умножения матрицы и вектора (до 10 элементов); эффективность алгоритмов умножения двух разряженных матриц при различной их загруженности.

### Способ обращения к программе

Обращение к программе происходит через исполняемый файл. Исходные данные вводятся через окно терминала или генерируются, вывод результатов производится в окно терминала.

### Аварийные ситуации и ошибки пользователя

* Некорректный ввод.
* Пустой ввод.
* Обработка пустой матрицы.

Во всех перечисленных случаях программа выдаёт сообщение об ошибке.

## Описание СД

Матрица представлена в классическом и разреженном строчном форматах. Для классического формата используется структура table_classic, которая хранит ненулевые элементы матрицы, и classic_matrix, в котором находятся данные для каждого ненулевого элемента матрицы. Матрица в разряженном строчном формате для хранение использует структуру spare_matrix.

В данной реализации лабораторной работы была выбран способ хранения классической матрицы в виде структуры. Это дало преумещество в удобстве работы с ней, но оказалось более затратной по памяти.

```
// Ненулевой элемент матрицы
struct classic_matrix{    float data;		// Значение    int height;		// Индекс строки    int width;		// Индекс столбца};// Матрица в разряженном строчном форматеstruct spare_matrix{    int n;			// Размер матрицы    int nz;			// Количество ненулевых элементов матрицы    float *a;		// Массив значений    int *ia;		// Массив индексов столбцов    int *ja;		// Массив индексов начала строк};// Ненулевые элементы матрицыstruct table_classic{    struct classic_matrix *p;	// Массив ненулевых элементов матрицы    int n;						// Количество строк матрицы
    int h;						// Количество столбцов матрицы};
```

## Описание алгоритма

Пользователю выводится меню программы, через которое идёт основное управление. Матрицу можно ввести вручную или сгенерировать по указанным размерам. Для классического метода хранения данные записываются в структуру classic_matrix, указатель на которую хранится в структуре table_classic. Для хранения матрицы в разреженном строчном виде используется структура spare_matrix.

При ручном вводе запрашиваются размеры, количество ненулевых элементов и сами элементы с их индексами по строке и столбцу. Записав данные в classic_matrix, мы запоминаем указатель на эту структуру в table_classic. В spare_matrix сначала происходит запись значений элементов и их индексов по столбцу, затем эти данные сортируются по возрастанию идексов и на их основе заполняется массив индексов начала строк. При генерации матрицы сортировка опускается, т.к. значения изначально уже стоят в правильном порядке.

В классическом методе проходим по всем элементам матрицы и вектора, перемножая элементы вектора на соответствующие элементы столбцов матрицы. При различной заполненности матрицы время, затраченное на перемножение, будет примерно одним и тем же.

В разряженном метотоде проходим только по ненулевым элементам матрицы и ветора. Результирующие значения заполняются по мере прохождения строк матрицы. Ненулевые элементы матрицы, индексы которых находятся в интервале текущей строки, перемножаются с сответствующими ненулевыми элементами вектора.

## Тесты

**Время**

|Процент заполненности|Classic|Spare|Отношение|
|:-:|:-:|:-:|:-:|
|0|120577|1583|0.01|
|10|198553|14027|0.07|
|20|131310|89463|0.68|
|23|131883|134338|1.02|
|100|130132|11421620|87.77|

**Объём памяти**

|Процент заполненности|Classic|Spare|Отношение|
|:-:|:-:|:-:|:-:|
|0|1212|412|0.34|
|10|1212|492|0.41|
|20|1212|572|0.47|
|23|1212|596|0.49|
|100|1212|1212|1.00|

## Выводы

В ходе данной лабораторной работы были реализованы алгоритмы обработки разреженных матриц и произведено сравнение эффективности использования этих алгоритмов со стандартными алгоритмами обработки матриц при различном процентном заполнении матриц ненулевыми значениями и при различных размерах матриц.

Разреженные матрицы целесообразно использовать при заполненности матрицы меньше 20-25 процетов. По причине хранения классической матрицы в виде структуры, объём памяти занимаемый разреженной матрицей при любом проценте заполненности не превышало объём памяти классической. При реализации массивами мы смогли убедиться бы в том, что приопределённом проценте заполненности, память разреженной матрицы превысила классическую. Так же следует отметить, что при уменьшении матрицы эффективность её использования уменьшается.

## Вопросы

**1. Что такое разреженная матрица, какие схемы хранения таких матриц Вы знаете?**

Матрицы, число ненулевых элементов которых при матрице порядка n может
выражаться как n^(1+g), где значения g лежат в интервале 0.2 ... 0.5, называются разреженными матрицами. Существуют различные методы хранения разреженных матриц:

* Линейный связный список (каждая ячейка списка содержит элемент списка и указатель на положение следующей ячейки);

* Кольцевой связный список;

* Диагональная схема хранения симметричных матриц;

* Связная схема разреженного хранения (в массивах хранятся значения, индексы строк и столбцов, номера следующих ненулевых элементов, номера элементов, с которых начинается строка, номера элементов, с которых начинается столбец);

* Разряженный строчный формат (в массивах хранятся значения ненулевых элементов, столбовые индексы, индексы начала строк).

**2. Каким образом и сколько памяти выделяется под хранение разреженной и обычной матрицы?**

Количество памяти, выделяемое под хранение разреженной и обычной матрицы зависит от метода хранения. Для классического метода для обычной матрицы выделяется память под каждый элемент, его индекс строки и индек столбца. Для разряженного строчного формата память выделяется под значение ненулевого элемента, номер его столбца и под вектор, содержащий индексы начала строк, численно равный количеству строк + 1.

**3. Каков принцип обработки разреженной матрицы?**

Например, есть два разреженных вектора a и b. Индексы элементов хранятся в массиве JA, значения элементов - в AN. Для сокращения алгебраических операций удобно во время работы хранить расширенный (по размерности массивов a и b) массив указателей IP (его начальное состояние - нулевое). Просматривается массив JA и в соответствующий элемент массива IP вписывается индекс массива JA. Таким образом хранятся указатели позиций ненулевых элементов в АN. Получается массив указателей IP.

**4. В каком случае для матриц эффективнее применять стандартные
алгоритмы обработки матриц? От чего это зависит?**

Для матриц эффективнее применять стандартные
алгоритмы обработки матриц в случае, если матрица содежит большое количество ненулевых элементов (больше 20-25%).